<% layout("/layout/boilerplate") -%>
<html>
  <body class="bg-light">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
          <!-- Card Wrapper -->
          <div
            class="card shadow-lg border-0 rounded-4 overflow-hidden listing-card"
          >
            <!-- Image Section -->
            <div class="show-img">
              <img
                src="<%= listing.image.url %>"
                class="card-img-top"
                alt="<%= listing.title %>"
              />
            </div>

            <!-- Listing Details -->
            <div class="card-body p-4">
              <h3 class="text-center mb-4 fw-bold">Listing Details</h3>

              <ul class="list-group list-group-flush mb-4">
                <li class="list-group-item">
                  <strong>Title:</strong> <%= listing.title %>
                </li>
                <li class="list-group-item">
                  <strong>Description:</strong> <%= listing.description %>
                </li>
                <li class="list-group-item">
                  <strong>Price:</strong> ‚Çπ <%=
                  listing.price.toLocaleString("en-IN") %>
                </li>
                <li class="list-group-item">
                  <strong>Location:</strong> <%= listing.location %>
                </li>
                <li class="list-group-item">
                  <strong>Country:</strong> <%= listing.country %>
                </li>
              </ul>

              <!-- Action Buttons -->
              <div class="d-flex justify-content-between mb-4">
                <form method="GET" action="/listing/<%= listing._id %>/edit">
                  <button class="btn btn-warning">‚úèÔ∏è Edit</button>
                </form>

                <form
                  method="POST"
                  action="/listing/<%= listing._id %>?_method=DELETE"
                  onsubmit="return confirm('Are you sure you want to delete this listing?');"
                >
                  <button class="btn btn-danger">üóëÔ∏è Delete</button>
                </form>
              </div>

              <!-- Review Section -->
              <hr />
              <div class="review-section mt-4">
                <h4 class="mb-3">Leave a Review</h4>
                <form
                  method="POST"
                  action="/listing/<%= listing._id %>/reviews"
                >
                  <div class="mb-3">
                    <label for="rating" class="form-label">Rating</label>
                    <input
                      type="range"
                      name="review[rating]"
                      id="rating"
                      class="form-range"
                      min="1"
                      max="5"
                      required
                    />
                  </div>

                  <div class="mb-3">
                    <label for="comment" class="form-label">Comment</label>
                    <textarea
                      name="review[comment]"
                      id="comment"
                      class="form-control"
                      rows="3"
                      required
                      novalidate
                      class="row g-3 needs-validation"
                    ></textarea>
                  </div>

                  <button class="btn btn-primary w-100">Submit Review</button>
                </form>
                <hr />
                <p><b>All Reviews</b></p>
                <div class="row">
                  <% for(review of listing.reviews) {%>
                  <div class="card col-5 ms-3 mb-3">
                    <p class="card-text"><%= review.comment %></p>
                    <p class="card-text"><%= review.rating %>star</p>
                  </div>
                  <form
                    method="POST"
                    action="/listing/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
                  >
                    <button btn class="btn btn-outline-danger mb-3" type="submit" >Delete</button>
                  </form>
                  <% }%>
                
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
